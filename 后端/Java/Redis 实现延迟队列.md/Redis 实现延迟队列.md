

# 目录

[TOC]

# 1、执行过程理解

## 1.1、依赖的 3 种数据结构

MAP：用来保存实际需要处理的任务对象。

ZSET：利用 ZSET 的 score 特性，实现时间排序，定位到即将执行的任务标识。

LIST：一个队列结构，方便后面消费者消费。

## 1.2、执行过程图解

![image-20230210171613747](Redis%20%E5%AE%9E%E7%8E%B0%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97.assets/image-20230210171613747.png)

## 1.3、问题及思考

为什么不直接使用 ZSET 结构来实现延迟队列，还要使用 MAP 和 LIST 结构？

答：使用 LIST 结构是因为其本身就是一个天然的队列模型，消费端在消费时不需要进行查找，顺序消费即可，并且可以让多个消费者同时进行任务消费，提高了系统的性能。

使用 MAP 结构是因为通常情况下任务对象所占用的空间都比较大，如果直接将任务对象存储在 ZSET 结构中，当定时任务调度器发现符合条件的任务对象时，会将任务对象从 ZSET 结构中转移到 LIST 结构中，这样就耗费了大量的系统资源。我们可以把任务对象放到 MAP 结构中，ZSET 中只存储任务在 MAP 结构中的唯一标识，当定时任务调度器发现符合条件的任务对象时，会将任务对象的唯一标识转移到 LIST 结构中，这样就能节省一部分资源，当消费者在 LIST 结构中获取到任务在 MAP 结构中的唯一标识，再在 MAP 中获取数据，这样就提高系统的性能。